# Support Portal ‚Äî –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ

## –û–ø–∏—Å–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

**Support Portal** ‚Äî –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞–º–∏ (–∞–ø—Ç–µ–∫–∞–º–∏), –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º–∏ –∏ —Å–µ—Ç–µ–≤–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π.

### –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-----------|-----------|------------|
| Backend | Django 4.x + Django REST Framework | REST API, –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞, –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è |
| Frontend | React 18 + Ant Design | –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å |
| –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö | PostgreSQL 16 | –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö |
| –í–µ–±-—Å–µ—Ä–≤–µ—Ä | Nginx (Alpine) | –ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ, —Ä–∞–∑–¥–∞—á–∞ —Å—Ç–∞—Ç–∏–∫–∏ –∏ –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤ |
| –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è | Docker + Docker Compose | –ò–∑–æ–ª—è—Ü–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞–º–∏ |

### –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏ –∏ —Ñ—É–Ω–∫—Ü–∏–∏

**–ö–ª–∏–µ–Ω—Ç—ã**
- –ö–∞—Ä—Ç–æ—á–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞: –∞–¥—Ä–µ—Å, –∫–æ–º–ø–∞–Ω–∏—è, –ò–ù–ù, —Ç–µ–ª–µ—Ñ–æ–Ω, email, –∫–æ–¥ –∞–ø—Ç–µ–∫–∏, ICCID
- –ü—Ä–æ–≤–∞–π–¥–µ—Ä: –Ω–∞–∑–≤–∞–Ω–∏–µ, —Ç–∏–ø –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (‚ö° –û–ø—Ç–æ–≤–æ–ª–æ–∫–Ω–æ, ‚òéÔ∏è DSL, üîå –ö–∞–±–µ–ª—å, üì° –ë–µ—Å–ø—Ä–æ–≤–æ–¥–Ω–æ–µ, üì∂ –ú–æ–¥–µ–º, ‚ÜîÔ∏è MR-Net), —Ç–∞—Ä–∏—Ñ, –ª–∏—Ü–µ–≤–æ–π —Å—á—ë—Ç, ‚Ññ –¥–æ–≥–æ–≤–æ—Ä–∞, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
- –°–µ—Ç—å: –ø–æ–¥—Å–µ—Ç—å –∞–ø—Ç–µ–∫–∏, –≤–Ω–µ—à–Ω–∏–π IP, –ú–∏–∫—Ä–æ—Ç–∏–∫ IP (–∞–≤—Ç–æ: .1), –°–µ—Ä–≤–µ—Ä IP (–∞–≤—Ç–æ: .2)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ IP-–∞–¥—Ä–µ—Å–æ–≤ (ping)
- –ü–æ–ª—É—á–µ–Ω–∏–µ –≤–Ω–µ—à–Ω–µ–≥–æ IP —Å –ú–∏–∫—Ä–æ—Ç–∏–∫–∞ –ø–æ SSH
- –ó–∞–º–µ—Ç–∫–∏ –∏ –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 2 –∑–∞–ø–∏—Å–∏ –≤–∏–¥–Ω—ã —Å—Ä–∞–∑—É, –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å–≤–æ—Ä–∞—á–∏–≤–∞—é—Ç—Å—è)
- –í–ª–æ–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (–¥–æ 5 –ú–ë –Ω–∞ —Ñ–∞–π–ª, —Ö—Ä–∞–Ω—è—Ç—Å—è –Ω–∞ –¥–∏—Å–∫–µ)
- –°–∏—Å—Ç–µ–º–∞ —á–µ—Ä–Ω–æ–≤–∏–∫–æ–≤ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞ (ID —Ä–µ–∑–µ—Ä–≤–∏—Ä—É–µ—Ç—Å—è —Å—Ä–∞–∑—É, —Ñ–∞–π–ª—ã –º–æ–∂–Ω–æ –ø—Ä–∏–∫—Ä–µ–ø–ª—è—Ç—å –¥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è)

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ —Ä–æ–ª–∏**
- RBAC: —Ä–æ–ª–∏ —Å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏
- –ü—Ä–∞–≤–∞: –ø—Ä–æ—Å–º–æ—Ç—Ä, —Å–æ–∑–¥–∞–Ω–∏–µ, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–≤, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏, —Ä–æ–ª—è–º–∏, –ø–æ–ª—è–º–∏

**–ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã**
- –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –¥–ª—è –≤—ã–±–æ—Ä–∞ –≤ –∫–∞—Ä—Ç–æ—á–∫–µ –∫–ª–∏–µ–Ω—Ç–∞

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã** (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤)
- SSH-–ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ú–∏–∫—Ä–æ—Ç–∏–∫–∞–º (–ª–æ–≥–∏–Ω, –ø–∞—Ä–æ–ª—å —Ö—Ä–∞–Ω–∏—Ç—Å—è –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–º —á–µ—Ä–µ–∑ Fernet)

---

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É

- Ubuntu 20.04 / 22.04 / 24.04
- 2 –ì–ë RAM –º–∏–Ω–∏–º—É–º (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 4 –ì–ë)
- 20 –ì–ë –¥–∏—Å–∫–∞
- –û—Ç–∫—Ä—ã—Ç—ã–π –ø–æ—Ä—Ç 80 (–∏ 443 –ø—Ä–∏ HTTPS)
- Docker 24+ –∏ Docker Compose Plugin

---

## 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

```bash
# –û–±–Ω–æ–≤–ª—è–µ–º –ø–∞–∫–µ—Ç—ã
apt update && apt upgrade -y

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Docker
curl -fsSL https://get.docker.com | sh
apt install docker-compose-plugin -y

# –ü—Ä–æ–≤–µ—Ä—è–µ–º
docker --version
docker compose version
```

---

## 2. –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–æ–µ–∫—Ç

```bash
git clone https://github.com/suminslava55-droid/support-portal-new.git /opt/support-portal
cd /opt/support-portal
```

---

## 3. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
cp .env.example .env
nano .env
```

–°–æ–¥–µ—Ä–∂–∏–º–æ–µ `.env`:

```env
# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
DB_NAME=support_portal
DB_USER=postgres
DB_PASSWORD=CHANGE_ME_STRONG_PASSWORD
DB_HOST=db
DB_PORT=5432

# Django
SECRET_KEY=CHANGE_ME_VERY_LONG_SECRET_KEY_HERE
DEBUG=False
ALLOWED_HOSTS=your-ip-or-domain,localhost
CORS_ALLOWED_ORIGINS=http://your-ip-or-domain,http://localhost

# –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ SSH-–ø–∞—Ä–æ–ª—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
ENCRYPTION_KEY=CHANGE_ME_FERNET_KEY
```

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–Ω–∞—á–µ–Ω–∏–π

**SECRET_KEY:**
```bash
openssl rand -hex 50
```

**ENCRYPTION_KEY** (Fernet-–∫–ª—é—á –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è SSH-–ø–∞—Ä–æ–ª—è):
```bash
python3 -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
```
> –ï—Å–ª–∏ `cryptography` –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: `pip install cryptography`

**ALLOWED_HOSTS –∏ CORS_ALLOWED_ORIGINS:**
```env
# –¢–æ–ª—å–∫–æ IP
ALLOWED_HOSTS=94.130.1.1,localhost
CORS_ALLOWED_ORIGINS=http://94.130.1.1,http://localhost

# –° –¥–æ–º–µ–Ω–æ–º
ALLOWED_HOSTS=support.mycompany.ru,localhost
CORS_ALLOWED_ORIGINS=https://support.mycompany.ru,http://localhost
```

### –ò—Ç–æ–≥–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ–≥–æ .env

```env
DB_NAME=support_portal
DB_USER=postgres
DB_PASSWORD=qX7!mN3kP9@support
DB_HOST=db
DB_PORT=5432

SECRET_KEY=a3f8c2d1e4b7a9f0c3d6e2b5a8f1c4d7e0b3a6f9c2d5e8b1a4f7c0d3e6b9a2f5c8d1e4b7
DEBUG=False
ALLOWED_HOSTS=94.130.1.1,localhost
CORS_ALLOWED_ORIGINS=http://94.130.1.1,http://localhost

ENCRYPTION_KEY=ySKoI9K2_Uj2qjNUSxREYTFIW3o-HILiIMYZ5enMgYs=
```

> **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ nano:** `Ctrl+O` ‚Üí `Enter` ‚Üí `Ctrl+X`

---

## 4. –•—Ä–∞–Ω–∏–ª–∏—â–µ –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤

–í–ª–æ–∂–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ø–∞–ø–∫–µ `./media` –Ω–∞ —Ö–æ—Å—Ç–µ (bind mount). –ü–∞–ø–∫–∞ –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã backend –∏ nginx. –ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ —Ñ–∞–π–ª—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è.

```bash
# –°–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –Ω–æ –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –∑–∞—Ä–∞–Ω–µ–µ
mkdir -p /opt/support-portal/media
```

–°—Ç—Ä—É–∫—Ç—É—Ä–∞:
```
media/
‚îî‚îÄ‚îÄ clients/
    ‚îú‚îÄ‚îÄ 1/      ‚Üê —Ñ–∞–π–ª—ã –∫–ª–∏–µ–Ω—Ç–∞ ID=1
    ‚îú‚îÄ‚îÄ 2/
    ‚îî‚îÄ‚îÄ ...
```

---

## 5. –ó–∞–ø—É—Å–∫–∞–µ–º

```bash
cd /opt/support-portal
docker compose up -d --build
```

–ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ –∑–∞–Ω–∏–º–∞–µ—Ç 5‚Äì10 –º–∏–Ω—É—Ç. –°–ª–µ–¥–∏–º –∑–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–º:

```bash
docker compose logs -f
```

–ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—Å—Ç–∏–ª–∏—Å—å:

```bash
docker compose ps
```

–î–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω—ã: `support-portal-db-1`, `support-portal-backend-1`, `support-portal-nginx-1`.

---

## 6. –°–æ–∑–¥–∞—ë–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –∏ —Ä–æ–ª–∏

```bash
docker compose exec backend python create_admin.py
```

–°–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞—Å—Ç:
- –†–æ–ª—å **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä** —Å–æ –≤—Å–µ–º–∏ –ø—Ä–∞–≤–∞–º–∏
- –†–æ–ª—å **–¢–µ—Ö–Ω–∏–∫** —Å –ø—Ä–∞–≤–∞–º–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –ü–µ—Ä–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è-–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (–≤–≤–µ–¥–∏—Ç–µ email, –ø–∞—Ä–æ–ª—å, –∏–º—è)

---

## 7. –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ

1. –û—Ç–∫—Ä–æ–π—Ç–µ `http://–í–ê–®_IP` –≤ –±—Ä–∞—É–∑–µ—Ä–µ
2. –í–æ–π–¥–∏—Ç–µ –ø–æ–¥ —É—á—ë—Ç–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **–ù–∞—Å—Ç—Ä–æ–π–∫–∏** (–ª–µ–≤–æ–µ –º–µ–Ω—é, –≤–∏–¥–Ω–æ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º):
   - –£–∫–∞–∂–∏—Ç–µ **SSH –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å** –∏ **SSH –ø–∞—Ä–æ–ª—å** –¥–ª—è –ú–∏–∫—Ä–æ—Ç–∏–∫–æ–≤
4. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **–ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã** –∏ –¥–æ–±–∞–≤—å—Ç–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
5. –ù–∞—á–Ω–∏—Ç–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∫–∞—Ä—Ç–æ—á–∫–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤

---

## 8. –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤–Ω–µ—à–Ω–µ–≥–æ IP —Å –ú–∏–∫—Ä–æ—Ç–∏–∫–∞

–í –∫–∞—Ä—Ç–æ—á–∫–µ –∫–ª–∏–µ–Ω—Ç–∞ —Ä—è–¥–æ–º —Å –ø–æ–ª–µ–º **–í–Ω–µ—à–Ω–∏–π IP** –µ—Å—Ç—å –∫–Ω–æ–ø–∫–∞ **–ü–æ–ª—É—á–∏—Ç—å**. –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã:

1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø–æ–ª–µ **–ü–æ–¥—Å–µ—Ç—å –∞–ø—Ç–µ–∫–∏** ‚Äî –∏–∑ –Ω–µ–≥–æ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –ú–∏–∫—Ä–æ—Ç–∏–∫ IP (–ø–æ—Å–ª–µ–¥–Ω–∏–π –æ–∫—Ç–µ—Ç `.1`)
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞–ª–∏—á–∏–µ SSH-–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —Å–∏—Å—Ç–µ–º—ã
3. –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è ping –ú–∏–∫—Ä–æ—Ç–∏–∫–∞
4. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è SSH-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
5. –ù–∞ –ú–∏–∫—Ä–æ—Ç–∏–∫–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∫–æ–º–∞–Ω–¥–∞:
   ```
   :put ([/tool fetch url="https://api.ipify.org" http-method=get output=user as-value]->"data")
   ```
6. IP –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –≤ –ø–æ–ª–µ. –í—ã–≤–æ–¥–∏—Ç—Å—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ: –ø–æ–ª—É—á–µ–Ω –≤–ø–µ—Ä–≤—ã–µ / –∏–∑–º–µ–Ω–∏–ª—Å—è (—Å—Ç–∞—Ä—ã–π ‚Üí –Ω–æ–≤—ã–π) / –Ω–µ –∏–∑–º–µ–Ω–∏–ª—Å—è

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ú–∏–∫—Ä–æ—Ç–∏–∫—É:**
- SSH –ø–æ—Ä—Ç 22 –æ—Ç–∫—Ä—ã—Ç –∏ –¥–æ—Å—Ç—É–ø–µ–Ω
- –î–æ—Å—Ç—É–ø –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç (–¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ –∫ `api.ipify.org`)
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å –ø—Ä–∞–≤–∞–º–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥

---

## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker compose ps

# –õ–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
docker compose logs -f backend
docker compose logs -f nginx

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±—ç–∫–µ–Ω–¥ (–ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π Python-–∫–æ–¥–∞)
docker compose restart backend

# –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ (–ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏–ª–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞)
docker compose up -d --build

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –Ω–æ–≤—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏
docker compose exec backend python manage.py migrate

# –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ models.py
docker compose exec backend python manage.py makemigrations

# –°–ø–∏—Å–æ–∫ –º–∏–≥—Ä–∞—Ü–∏–π
docker compose exec backend python manage.py showmigrations

# –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è –ë–î
docker compose exec db pg_dump -U postgres support_portal > backup_$(date +%Y%m%d).sql

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏
cat backup_20240101.sql | docker compose exec -T db psql -U postgres support_portal
```

---

## –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

```bash
cd /opt/support-portal

# –ü–æ–ª—É—á–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
git pull

# –ü–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ–º
docker compose up -d --build

# –ü—Ä–∏–º–µ–Ω—è–µ–º –Ω–æ–≤—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)
docker compose exec backend python manage.py migrate
```

---

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

**–ë–µ–ª—ã–π —ç–∫—Ä–∞–Ω –≤ –±—Ä–∞—É–∑–µ—Ä–µ**
```bash
docker compose logs nginx --tail=30
```

**–û—à–∏–±–∫–∞ 500 –æ—Ç API**
```bash
docker compose logs backend --tail=50
```

**–ù–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –º–µ–¥–∏–∞—Ñ–∞–π–ª—ã (404 –Ω–∞ /media/)**
```bash
# –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞–ø–∫—É
ls -la /opt/support-portal/media/

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω—Ñ–∏–≥ nginx
docker compose exec nginx nginx -t
```

**TLS timeout –ø—Ä–∏ —Å–±–æ—Ä–∫–µ (–Ω–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞)**

Docker –Ω–µ –º–æ–∂–µ—Ç —Å–∫–∞—á–∞—Ç—å –±–∞–∑–æ–≤—ã–µ –æ–±—Ä–∞–∑—ã. –ï—Å–ª–∏ –æ–±—Ä–∞–∑—ã —É–∂–µ –±—ã–ª–∏ —Å–æ–±—Ä–∞–Ω—ã —Ä–∞–Ω–µ–µ ‚Äî –ø—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–µ–∑ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏:
```bash
docker compose up -d
```

**–ß–µ—Ä–Ω–æ–≤–∏–∫–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤ –Ω–∞–∫–∞–ø–ª–∏–≤–∞—é—Ç—Å—è –≤ –±–∞–∑–µ**
```bash
docker compose exec backend python manage.py shell -c "
from apps.clients.models import Client
from django.utils import timezone
from datetime import timedelta
old = Client.objects.filter(is_draft=True, created_at__lt=timezone.now()-timedelta(days=1))
print(f'–ù–∞–π–¥–µ–Ω–æ —á–µ—Ä–Ω–æ–≤–∏–∫–æ–≤: {old.count()}')
for c in old:
    for f in c.files.all():
        f.file.delete()
        f.delete()
    c.delete()
print('–ì–æ—Ç–æ–≤–æ')
"
```

---

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ HTTPS (–µ—Å–ª–∏ –µ—Å—Ç—å –¥–æ–º–µ–Ω)

```bash
# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º certbot
apt install certbot python3-certbot-nginx -y

# –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º nginx Docker (–æ—Å–≤–æ–±–æ–∂–¥–∞–µ–º –ø–æ—Ä—Ç 80)
docker compose stop nginx

# –ü–æ–ª—É—á–∞–µ–º —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
certbot certonly --standalone -d –≤–∞—à-–¥–æ–º–µ–Ω.ru

# –î–æ–±–∞–≤—å—Ç–µ –≤ nginx/default.conf –±–ª–æ–∫ —Å SSL:
# server {
#   listen 443 ssl;
#   ssl_certificate /etc/letsencrypt/live/–≤–∞—à-–¥–æ–º–µ–Ω.ru/fullchain.pem;
#   ssl_certificate_key /etc/letsencrypt/live/–≤–∞—à-–¥–æ–º–µ–Ω.ru/privkey.pem;
#   ...
# }

# –ó–∞–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞—Ç–Ω–æ
docker compose start nginx
```

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
support-portal/
‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îú‚îÄ‚îÄ apps/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ accounts/             # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, —Ä–æ–ª–∏, JWT
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ clients/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ models.py         # Client, Provider, ClientFile, SystemSettings
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ views.py          # API + SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ú–∏–∫—Ä–æ—Ç–∏–∫—É
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ serializers.py
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ settings_views.py # –≠–Ω–¥–ø–æ–∏–Ω—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å–∏—Å—Ç–µ–º—ã
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ migrations/
‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ settings.py           # Django –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ urls.py
‚îÇ   ‚îú‚îÄ‚îÄ requirements.txt
‚îÇ   ‚îî‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ frontend/
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ClientsPage.jsx       # –°–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ClientDetailPage.jsx  # –ö–∞—Ä—Ç–æ—á–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ClientFormPage.jsx    # –°–æ–∑–¥–∞–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SettingsPage.jsx      # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ UsersPage.jsx         # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ProvidersPage.jsx     # –ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ AppLayout.jsx         # –ú–∞–∫–µ—Ç —Å –±–æ–∫–æ–≤—ã–º –º–µ–Ω—é
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ api/index.js              # Axios API-–∫–ª–∏–µ–Ω—Ç
‚îÇ   ‚îî‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ nginx/
‚îÇ   ‚îî‚îÄ‚îÄ default.conf              # –ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ API, —Ä–∞–∑–¥–∞—á–∞ /media/
‚îú‚îÄ‚îÄ media/                        # –ú–µ–¥–∏–∞—Ñ–∞–π–ª—ã (–Ω–∞ —Ö–æ—Å—Ç–µ, bind mount)
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ .env                          # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–Ω–µ –≤ git)
‚îî‚îÄ‚îÄ .env.example                  # –®–∞–±–ª–æ–Ω
```

---

## Python-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (requirements.txt)

| –ü–∞–∫–µ—Ç | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-------|-----------|
| django | –û—Å–Ω–æ–≤–Ω–æ–π –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫ |
| djangorestframework | REST API |
| djangorestframework-simplejwt | JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è |
| psycopg2-binary | –î—Ä–∞–π–≤–µ—Ä PostgreSQL |
| django-cors-headers | CORS –∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ |
| django-filter | –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤ API |
| python-dotenv | –ó–∞–≥—Ä—É–∑–∫–∞ .env —Ñ–∞–π–ª–∞ |
| cryptography | –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ SSH-–ø–∞—Ä–æ–ª—è (Fernet) |
| paramiko | SSH-–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ú–∏–∫—Ä–æ—Ç–∏–∫—É |
| gunicorn | WSGI-—Å–µ—Ä–≤–µ—Ä –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ |
| Pillow | –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π |
